<!doctype html>
<html lang="pl" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LifeOS â€” Kalendarz i zarzÄ…dzanie zespoÅ‚em</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .planner-grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;align-items:start}
    .stack{display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
    .section-title{margin:0 0 6px;font-size:16px;font-weight:700}
    .section-subtitle{margin:0 0 12px;font-size:12px;color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;background:var(--surface);font-size:12px;color:var(--muted);border:1px solid var(--line)}
    .chip strong{color:var(--ink)}
    .calendar-toolbar{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px}
    .calendar-title{margin:0;font-size:18px;font-weight:700}
    .btn{border:1px solid var(--line);background:var(--surface);color:var(--ink);padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
    .calendar-header,.calendar-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr))}
    .calendar-header div{padding:8px 6px;font-size:11px;color:var(--muted);text-transform:uppercase;font-weight:700;text-align:center}
    .day{min-height:110px;border:1px solid var(--line);padding:8px;border-radius:12px;background:#fff;display:flex;flex-direction:column;gap:6px}
    .day.muted{opacity:.45}
    .day.today{outline:2px solid hsl(var(--accent-h) 80% 70%/.6);outline-offset:-2px}
    .day-num{font-size:12px;font-weight:700}
    .events{display:grid;gap:5px}
    .event{font-size:11px;padding:4px 6px;border-radius:8px;line-height:1.2}
    .event.work{background:#ede9fe;color:#5b21b6}
    .event.private{background:#dcfce7;color:#166534}
    .event.team{background:#dbeafe;color:#1e40af}
    form{display:grid;gap:10px}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff;font-family:inherit}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .task-list{display:grid;gap:8px}
    .task-item{display:flex;justify-content:space-between;gap:10px;padding:10px;border:1px solid var(--line);border-radius:10px;background:var(--surface)}
    .task-meta{font-size:11px;color:var(--muted)}
    .team-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .member{padding:10px;border:1px solid var(--line);border-radius:12px;background:var(--surface)}
    .member h4{margin:0 0 4px;font-size:13px}
    .member ul{margin:0;padding-left:16px;font-size:12px;display:grid;gap:4px}
    .notes-list{display:grid;gap:8px}
    .note{border:1px solid var(--line);border-radius:10px;padding:10px;background:#fffbe8}
    .note h5{margin:0 0 4px;font-size:12px}
    .note p{margin:0;font-size:12px;white-space:pre-wrap}
    @media (max-width:1100px){.planner-grid{grid-template-columns:1fr}.team-grid,.row{grid-template-columns:1fr}.day{min-height:90px}}
  </style>
</head>
<body data-page="tasks">
  <div class="app-shell">
    <aside class="sidebar" aria-label="GÅ‚Ã³wna nawigacja">
      <div class="sidebar__header"><span class="sidebar__emoji">ğŸ§­</span><span class="sidebar__brand">LifeOS</span></div>
      <nav class="sidebar__nav" aria-label="Sekcje LifeOS">
        <ul class="sidebar__list">
          <li class="sidebar__item"><a class="sidebar__link" href="index.html" data-page="dashboard"><span class="sidebar__icon">ğŸ“Š</span><span class="sidebar__label">Dashboard</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="budget.html" data-page="budget"><span class="sidebar__icon">ğŸ’°</span><span class="sidebar__label">BudÅ¼et</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="tasks.html" data-page="tasks"><span class="sidebar__icon">ğŸ—“ï¸</span><span class="sidebar__label">Kalendarz</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="trainings.html" data-page="trainings"><span class="sidebar__icon">ğŸ’ª</span><span class="sidebar__label">Progres</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="fuel.html" data-page="fuel"><span class="sidebar__icon">â›½</span><span class="sidebar__label">Paliwo</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="loan.html" data-page="loan"><span class="sidebar__icon">ğŸ¦</span><span class="sidebar__label">Kredyt</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="inventory.html" data-page="inventory"><span class="sidebar__icon">ğŸ“¦</span><span class="sidebar__label">Magazyn</span></a></li>
          <li class="sidebar__item"><a class="sidebar__link" href="house.html" data-page="house"><span class="sidebar__icon">ğŸ </span><span class="sidebar__label">Budowa</span></a></li>
        </ul>
      </nav>
    </aside>

    <main class="app-main">
      <header class="page-header">
        <div class="page-header__top">
          <p class="page-overline">TASKS 2.0</p>
          <h1 class="page-title"><span class="page-title__icon">ğŸ—“ï¸</span><span class="page-title__text">Nowoczesny planer: kalendarz + zespÃ³Å‚ + notatki</span></h1>
          <p class="page-subtitle">Przebudowany moduÅ‚ do planowania zadaÅ„ prywatnych i sÅ‚uÅ¼bowych, delegowania i przygotowania do spotkaÅ„.</p>
        </div>
      </header>

      <section class="page-content">
        <div class="chips" id="kpiChips"></div>
        <div class="planner-grid">
          <div class="stack">
            <article class="card">
              <div class="calendar-toolbar">
                <button class="btn" id="prevMonth">â†</button>
                <h2 class="calendar-title" id="monthTitle"></h2>
                <button class="btn" id="nextMonth">â†’</button>
              </div>
              <div class="calendar-header"><div>Pon</div><div>Wt</div><div>Åšr</div><div>Czw</div><div>Pt</div><div>Sob</div><div>Nd</div></div>
              <div class="calendar-grid" id="calendarGrid"></div>
            </article>

            <article class="card">
              <h3 class="section-title">Twoje zadania</h3>
              <p class="section-subtitle">Dodawaj zadania prywatne lub sÅ‚uÅ¼bowe i przypisuj je do konkretnej daty.</p>
              <form id="taskForm">
                <input name="title" placeholder="Np. PrzygotowaÄ‡ prezentacjÄ™ kwartalnÄ…" required>
                <div class="row">
                  <select name="type"><option value="work">SÅ‚uÅ¼bowe</option><option value="private">Prywatne</option></select>
                  <input type="date" name="date" required>
                </div>
                <button class="btn primary" type="submit">Dodaj zadanie</button>
              </form>
              <div class="task-list" id="taskList"></div>
            </article>
          </div>

          <div class="stack">
            <article class="card">
              <h3 class="section-title">ZespÃ³Å‚ (4 osoby)</h3>
              <p class="section-subtitle">Szybki podglÄ…d priorytetÃ³w i egzekucji dla czÅ‚onkÃ³w zespoÅ‚u.</p>
              <form id="teamForm">
                <div class="row">
                  <select name="owner" required>
                    <option value="Ania">Ania</option><option value="Bartek">Bartek</option><option value="Karolina">Karolina</option><option value="MichaÅ‚">MichaÅ‚</option>
                  </select>
                  <input type="date" name="date" required>
                </div>
                <input name="title" placeholder="Np. DomknÄ…Ä‡ backlog sprintu" required>
                <button class="btn" type="submit">Przypisz task zespoÅ‚owy</button>
              </form>
              <div class="team-grid" id="teamBoard"></div>
            </article>

            <article class="card">
              <h3 class="section-title">Notatki do spotkaÅ„ / 1:1 / rekrutacji</h3>
              <form id="noteForm">
                <input name="topic" placeholder="Temat notatki (np. 1:1 Ania)" required>
                <textarea name="content" rows="4" placeholder="NajwaÅ¼niejsze punkty, follow-up, decyzje..." required></textarea>
                <button class="btn" type="submit">Zapisz notatkÄ™</button>
              </form>
              <div class="notes-list" id="notesList"></div>
            </article>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const state = {
      viewDate: new Date(),
      tasks: JSON.parse(localStorage.getItem('lifeos_tasks_v2') || '[]'),
      teamTasks: JSON.parse(localStorage.getItem('lifeos_team_tasks_v2') || '[]'),
      notes: JSON.parse(localStorage.getItem('lifeos_notes_v2') || '[]')
    };

    const fmt = (d) => new Date(d).toISOString().slice(0,10);
    const todayStr = fmt(new Date());

    const els = {
      monthTitle: document.getElementById('monthTitle'),
      calendarGrid: document.getElementById('calendarGrid'),
      taskList: document.getElementById('taskList'),
      teamBoard: document.getElementById('teamBoard'),
      notesList: document.getElementById('notesList'),
      kpiChips: document.getElementById('kpiChips')
    };

    function saveAll(){
      localStorage.setItem('lifeos_tasks_v2', JSON.stringify(state.tasks));
      localStorage.setItem('lifeos_team_tasks_v2', JSON.stringify(state.teamTasks));
      localStorage.setItem('lifeos_notes_v2', JSON.stringify(state.notes));
    }

    function renderKPIs(){
      const overdue = state.tasks.filter(t => t.date < todayStr).length + state.teamTasks.filter(t => t.date < todayStr).length;
      const upcoming = state.tasks.filter(t => t.date >= todayStr).length;
      els.kpiChips.innerHTML = `
        <div class="chip">ğŸ“Œ Aktywne: <strong>${upcoming}</strong></div>
        <div class="chip">ğŸ‘¥ Zadania zespoÅ‚u: <strong>${state.teamTasks.length}</strong></div>
        <div class="chip">ğŸ“ Notatki: <strong>${state.notes.length}</strong></div>
        <div class="chip">âš ï¸ Przeterminowane: <strong>${overdue}</strong></div>`;
    }

    function renderCalendar(){
      const year = state.viewDate.getFullYear();
      const month = state.viewDate.getMonth();
      els.monthTitle.textContent = state.viewDate.toLocaleDateString('pl-PL', { month:'long', year:'numeric' });
      const first = new Date(year, month, 1);
      const startOffset = (first.getDay() + 6) % 7;
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const prevMonthDays = new Date(year, month, 0).getDate();
      const cells = [];

      for(let i=startOffset-1;i>=0;i--) cells.push({day:prevMonthDays - i, muted:true, date:new Date(year, month-1, prevMonthDays-i)});
      for(let d=1; d<=daysInMonth; d++) cells.push({day:d, muted:false, date:new Date(year, month, d)});
      while(cells.length % 7 !== 0) {
        const d = cells.length - (startOffset + daysInMonth) + 1;
        cells.push({day:d, muted:true, date:new Date(year, month+1, d)});
      }

      els.calendarGrid.innerHTML = cells.map(c => {
        const ds = fmt(c.date);
        const events = [
          ...state.tasks.filter(t => t.date === ds).map(t => ({title:t.title, cls:t.type})),
          ...state.teamTasks.filter(t => t.date === ds).map(t => ({title:`${t.owner}: ${t.title}`, cls:'team'}))
        ].slice(0,3);
        const eventHtml = events.map(e => `<div class="event ${e.cls}">${e.title}</div>`).join('');
        return `<div class="day ${c.muted?'muted':''} ${ds===todayStr?'today':''}"><div class="day-num">${c.day}</div><div class="events">${eventHtml}</div></div>`;
      }).join('');
    }

    function renderTasks(){
      const sorted = [...state.tasks].sort((a,b) => a.date.localeCompare(b.date));
      els.taskList.innerHTML = sorted.length ? sorted.map(t => `
        <div class="task-item"><div><strong>${t.title}</strong><div class="task-meta">${t.type==='work'?'SÅ‚uÅ¼bowe':'Prywatne'} â€¢ ${t.date}</div></div></div>
      `).join('') : '<p class="section-subtitle">Brak zadaÅ„. Dodaj pierwsze zadanie.</p>';
    }

    function renderTeam(){
      const members = ['Ania','Bartek','Karolina','MichaÅ‚'];
      els.teamBoard.innerHTML = members.map(m => {
        const items = state.teamTasks.filter(t => t.owner===m).sort((a,b)=>a.date.localeCompare(b.date));
        return `<div class="member"><h4>${m}</h4><ul>${items.length ? items.map(i => `<li>${i.title} <small>(${i.date})</small></li>`).join('') : '<li>Brak taskÃ³w</li>'}</ul></div>`;
      }).join('');
    }

    function renderNotes(){
      const sorted = [...state.notes].reverse();
      els.notesList.innerHTML = sorted.length ? sorted.map(n => `<div class="note"><h5>${n.topic}</h5><p>${n.content}</p></div>`).join('') : '<p class="section-subtitle">Brak notatek. Dodaj notatkÄ™ do przygotowaÅ„ spotkaÅ„.</p>';
    }

    document.getElementById('prevMonth').addEventListener('click', ()=>{ state.viewDate.setMonth(state.viewDate.getMonth()-1); renderCalendar(); });
    document.getElementById('nextMonth').addEventListener('click', ()=>{ state.viewDate.setMonth(state.viewDate.getMonth()+1); renderCalendar(); });

    document.getElementById('taskForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const f = new FormData(e.target);
      state.tasks.push({ title:f.get('title').trim(), type:f.get('type'), date:f.get('date') });
      e.target.reset(); saveAll(); renderKPIs(); renderCalendar(); renderTasks();
    });

    document.getElementById('teamForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const f = new FormData(e.target);
      state.teamTasks.push({ owner:f.get('owner'), title:f.get('title').trim(), date:f.get('date') });
      e.target.reset(); saveAll(); renderKPIs(); renderCalendar(); renderTeam();
    });

    document.getElementById('noteForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const f = new FormData(e.target);
      state.notes.push({ topic:f.get('topic').trim(), content:f.get('content').trim() });
      e.target.reset(); saveAll(); renderKPIs(); renderNotes();
    });

    renderKPIs(); renderCalendar(); renderTasks(); renderTeam(); renderNotes();
  </script>
</body>
</html>
